/* ==UserStyle==
@name			Mastodonカラム内ユーザーTOPを圧縮
@description	カラム表示時のユーザーページの上部を色々と圧縮表示
@namespace		https://github.com/Phroneris
@version		1.1.3
@author			森の子リスのミーコの大冒険（Phroneris）
@homepageURL	https://github.com/Phroneris/Stylus
@supportURL		https://github.com/Phroneris/Stylus/issues
@updateURL		https://github.com/Phroneris/Stylus/raw/master/usercss/mastodon_compress-usertop.user.css
@license		CC0-1.0
@preprocessor	stylus

@var			checkbox smallenProfile "圧縮表示：プロフィール" 1
@var			checkbox smallenHosoku "圧縮表示：補足欄" 1
@var			checkbox smallenFF "圧縮表示：投稿数・FF数の欄" 1
@var			checkbox smallenTab "圧縮表示：TL切り替え部" 1
@var			checkbox smallenPinned "固定トゥートを畳む" 1
@var			select openStylePinned "┗ 再展開方法" {
	"クリックや選択": "focus",
	"マウスオーバー": "hover"
}
==/UserStyle== */

/* ==ChangeLog==
	2019/02/22 v1.1.3
	* このChangeLogを追加
	* 対応インスタンスを追加（自分のために）
	* リポジトリ整理に伴い@updateURLを修正
*/

@-moz-document domain("gensokyo.town"), domain("otoya.space"), domain("friends.nico"), domain("mstdn.jp"), domain("pawoo.net"), domain("mastodon.social"), domain("qiitadon.com")
	// ちなみにQiitadonでは固定トゥートを畳めない（2019/2/21時点）。
	// 場当たり的に対応できなくはないが、より根っこの部分（※）を突き止めるのがめんどい。
	// （※ QiitadonのMastodonバージョンが古いせいなのか、だとしたらいつ本家の仕様が変わったか、それをCSSだけでどうやって区別できるか、など）

	div.account__header > div
		/*	プロフィールを圧縮表示
			・アイコン‐名前‐ID（‐Botバッジ）‐文（‐補足欄）の間隔や各行間を詰める。
			・文の空行を詰める。
		*/
		if smallenProfile
			/* プロフィール全体 */
			userTPad = 20px - 5px
			userBPad = userTPad - 3px
			padding-top: userTPad
			padding-bottom: userBPad
			/* 補足欄（調整） */
			.account__header__fields
				margin-top: userBPad
				margin-bottom: - userBPad
			/* アイコン */
			a.account__header__avatar
				margin-bottom: 10px - 4px
			/* 名前 */
			span.account__header__display-name
				line-height: 27px - 7px
				margin-top: 2px
				margin-bottom - 2px
			/* ID */
			span.account__header__username
				line-height: 18px - 4px
				margin-bottom: 0	// デフォルト10px。下の変数で代用
			existingBioTop = 10px - 5px
			/* Botバッジ */
			div.roles
				margin-top: existingBioTop
				margin-bottom: 0
			/* 文 */
			div.account__header__content
				p
					line-height: 18px - 2px
					forceWrap = 1	// 「見境なく改行」オプションを設けようかと思ったけどいいや、勝手にやる。
					if forceWrap
						word-break: break-all
				> p:first-child:not(:empty)
					margin-top: existingBioTop
				/* 文の空行 */
				> p:nth-last-child(n+2)
					margin-bottom: 20px - 15px
		if smallenHosoku
			/* 補足欄を圧縮表示（ほんとは固定トゥートみたいにクリックで畳みたいが、CSS3だけではできなさそう） */
			div.account__header__fields
				border-top: 0px
				dl
					border-bottom: 0
					dt, dd
						hosokuVPad = 14px - 8px
						padding: hosokuVPad 20px - 10px hosokuVPad - 3px
						// &:focus
						// 	background-color: red
	/* 投稿数・FF数の欄を圧縮表示 */
	if smallenFF
		div.account__action-bar
			line-height: 0
			a.account__action-bar__tab, div.account__action-bar-dropdown
				ffPad = 10px - 3px
				padding-top: ffPad + 0px
				padding-bottom: ffPad - 5px
				> span
					line-height: 18px - 5px
				> strong
					line-height: 18px - 4px
			a.account__action-bar__tab.active
				border-bottom-width: 1px
			button	// こいつ正直よくわからない…。
				// line-height: 0px !important
				height: 0px !important
				// position: relative
				// top: 0px
	/* TL切り替え部を圧縮表示 */
	if smallenTab
		div.account__section-headline > a
			tabVPad = 15px - 7px
			padding-top: tabVPad + 1px
			padding-bottom: tabVPad
			&.active
				triWidth = 10px - 3px
				&::before, &::after
					border-width: triWidth triWidth + 2px

	/*	固定トゥートを畳む
		・消しはしないので「固定トゥートがある」ということはわかる。
		・日時だけ残すので頻繁に目にする場合は更新があれば気付ける。
		・「クリックや選択」または「マウスオーバー」で再展開する。
		（ほんとはマウスオーバー範囲をピン部分だけとかに限定したいけど、CSS3では先読みを要する親要素や兄要素への作用はできない）
		（クリックや選択の場合、トゥート内のリンクやCWや画像をクリックするとトゥート自体の選択が解かれてしまう不具合あり）
		・カラム内ユーザーページでだけ有効、カラム内単トゥートページや個別ユーザーページなどには効かない（命名則が違うので）。
	*/
	if smallenPinned
		/* 固定トゥート全体 */
		div[data-featured="true"]:not(:{openStylePinned})
			border-bottom: 1px solid #393f4f	// 全体の下線をこちらに回す。
			// height: 34px						// これがないとなんかラベルの高さが増える。	// と思っていたが、下記のafterによってそうならなくなった。
			/* 「固定されたトゥート」ラベル全体 */
			div.status__prepend
				display: inline-block
				padding-bottom: 8px
				span
					display: none				// 「固定されたトゥート」というラベル文。消さないとカラム幅次第では日付が長い場合にかぶる。
				&::after
					content: "固定トゥート"		// かぶらない短さ。ほんとはユーザー変数で指定したいけど、日本語文字列を受け付けてくれない…。
			/* ラベル以外のトゥート全体（情報、本文、メディア、アクション） */
			div.status
				display: inline-block
				position: absolute
				right: 10px
				padding-right: 0
				border: 0						// 全体の下線をなくす。
				min-height: 0px					// 表示に影響はないが、不要な広さが確保されて要素検証時に目障りなので削る。
				/* 情報（時間、名前、アイコン）のうち時間以外 */
				div.status__info a:nth-child(n+2)
					display: none
				/* 情報以外（本文、メディア、アクション、リンク先のカード） */
				div:nth-of-type(n+2), a.status-card
					display: none

